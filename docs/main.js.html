

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cellular Automata main.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Cellular Automata</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                 
                    
                        <a
                            class="link user-link "
                            href=""
                        >
                            
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="CA.html">CA</a></li></ul><h3>Global</h3><ul><li><a href="global.html#drawRow">drawRow</a></li><li><a href="global.html#drawRule">drawRule</a></li><li><a href="global.html#setup">setup</a></li><li><a href="global.html#setupCavas">setupCavas</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>main.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import './style.scss';
import { CA } from './automata.mjs';

// Globals
let M;
let cellSize;
let ctx;

setup();

/**
 * Setup DOM elements needed at start
 * @function setup
 */
function setup() {
  // Define canvas for drawing automaton
  ctx = $('#grid')[0].getContext('2d');

  // New automata form
  $('#create-ca').on('submit', function (e) {
    e.preventDefault();
    resetAnimation();
    const colNum = parseInt(e.target.cols.value);
    const startType = e.target.start.value;

    // Format rule
    let rule = parseInt(e.target.rule.value);
    const automataType = 'Rule ' + rule;
    rule = rule.toString(2).padStart(8, '0');
    rule = rule.split('').reverse().join('');

    M = new CA(colNum, rule, startType);
    setupCavas();

    // Set info text
    $('#automata-name').text(automataType);
    $('#rule-string').text(M.rule);
    $('.info').show();
    $('#automata').show();
    drawRule();

    return false;
  });

  // Animate/stop animation button
  let animate = false;
  let interval;
  $('button#animate').on('click', function () {
    const speed = $('#speed').val();

    if (!animate) {
      interval = setInterval(() => {
        M.iterate();
        drawRow();
      }, (speed * 1000));
      $(this).text('Stop Animation');
    }
    else {
      clearInterval(interval);
      $(this).text('Animate');
    }
    animate = !animate;
  });

  // Stop animation and reset button
  const resetAnimation = () => {
    clearInterval(interval);
    animate = false;
    $('button#animate').text('Animate');
  };

  // Set iterate button
  $('button#iterate').on('click', () => {
    resetAnimation();
    M.iterate();
    drawRow();
  });
}

/**
 * Draw a visual representation of the current rule
 * @function drawRule
 */
function drawRule() {
  const ruleCtx = $('#rule-display')[0].getContext('2d');

  const boxSize = 35;
  const gap = 3;
  const sep = 5 * gap;

  // Define resolution once
  if (!$('#rule-display').attr('width')) {
    const totalBoxes = 8 * 3;
    $('#rule-display').attr('width', (totalBoxes * boxSize) + (totalBoxes * gap) + (8 * sep));
    $('#rule-display').attr('height', boxSize * 2 + sep + 2);
  }

  let ruleNum = 1;
  let boxNum = 0;

  // Draw boxes for each neighbourhood combination
  for (let r = 7; r >= 0; r--) {
    // Draw rule box
    ruleCtx.fillStyle = parseInt(M.rule[r]) ? 'black' : 'white';
    const x = Math.floor(((ruleNum * (boxSize * 3)) + (ruleNum * (gap * 3)) + (ruleNum * sep)) - ((boxSize * 2) + gap));
    ruleCtx.fillRect(x, (boxSize + sep), boxSize, boxSize);
    ruleCtx.fillStyle = 'black';
    ruleCtx.strokeRect(x, (boxSize + sep), boxSize, boxSize);

    // Draw state boxes
    const neighbourhood = r.toString(2).padStart(3, '0');
    for (let n = 0; n &lt; 3; n++) {
      ruleCtx.fillStyle = parseInt(neighbourhood[n]) ? 'black' : 'white';
      const extraGap = (n == 0) ? sep : 0;
      const x = Math.floor((boxNum * boxSize) + (boxNum * gap) + ((ruleNum * sep) - extraGap) + extraGap);
      ruleCtx.fillRect(x, 0, boxSize, boxSize);
      ruleCtx.fillStyle = 'black';
      ruleCtx.strokeRect(x, 0, boxSize, boxSize);
      boxNum++;
    }
    ruleNum++;
  }
}

/**
 * Setup the canvas where the automata will be drawn
 * @function setupCavas
 * @todo dynamic grid height, better resolution
 */
function setupCavas() {
  const grid = $('#grid')[0];
  ctx.clearRect(0, 0, grid.width, grid.height);

  // Setup resolution
  const newWidth = Math.floor(1001 / M.colNum) * M.colNum * 2;
  if (newWidth != grid.width) {
    grid.width = newWidth;
    cellSize = Math.floor(grid.width / M.colNum);
    grid.height = cellSize * 1000;
  }

  // Draw starting state
  drawRow();
}

/**
 * Draw the current state of the automaton as a new row in the canvas
 * @function drawRow
 */
function drawRow() {
  // Draw all cells
  for (let c = 0; c &lt; M.colNum; c++) {
    ctx.fillStyle = M.cells[c] ? 'black' : 'white';
    ctx.fillRect((cellSize * c), M.iteration * cellSize, cellSize, cellSize);
  }
}
</code></pre>
        </article>
    </section>




            </div>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>
