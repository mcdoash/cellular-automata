<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Elementary CA Visualizer</title>
    <link rel="icon" type="image/png" href="./favicon.ico">
    <meta name="description" content="Visualize an Elementary Cellular Automata and it's rules from a Wolfram code."/>
    <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function l(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=l(e);fetch(e.href,o)}})();const g=class{constructor(i,t,l){this.width=i,this.rule=t,this.time=0,l=l!="middle"&&l!="random"?"middle":l,l=="middle"?(this.cells=[...new Array(this.width)].map(()=>0),this.cells[Math.floor(this.width/2)]=1):this.cells=[...new Array(this.width)].map(()=>Math.round(Math.random()))}step(){let i=[];for(let t=0;t<this.width;t++){const l=this.cells[(t-1+this.width)%this.width],s=this.cells[t],e=this.cells[(t+1)%this.width],o=parseInt(`${l}${s}${e}`,2);i[t]=parseInt(this.rule[o])}this.cells=i,this.time++}};let a,d,n,h;x();function x(){n=$("#grid")[0],n.ctx=n.getContext("2d"),h=$("<canvas>")[0],h.ctx=h.getContext("2d");const i=function(){const e=Math.floor($(window).width());$("#width").attr("max",e)};i(),$(window).on("resize",i),$("#create-ca").on("submit",function(e){e.preventDefault(),s();const o=parseInt(e.target.width.value),r=e.target.start.value;let c=parseInt(e.target.rule.value);const f="Rule "+c;return c=c.toString(2).padStart(8,"0"),c=c.split("").reverse().join(""),a=new g(o,c,r),v(),$("#automata-name").text(f),$("#rule-string").text(a.rule),$(".info").show(),$("#automata").show(),y(),!1});let t=!1,l;$("button#animate").on("click",function(){const e=$("#speed").val();t?(clearInterval(l),$(this).text("Animate")):(l=setInterval(()=>{a.step(),p(),$("#scroll").is(":checked")&&$(window).scrollTop($("#grid").offset().top),n.height>=h.height&&(clearInterval(l),$(this).text("End of Animation").attr("disabled","disabled"))},e*1e3),$(this).text("Stop Animation")),t=!t});const s=()=>{clearInterval(l),t=!1,$("button#animate").text("Animate")};$("button#step").on("click",()=>{s(),a.step(),p()})}function y(){const i=$("#rule-display")[0].getContext("2d"),t=35,l=3,s=5*l;$("#rule-display").attr("width")||($("#rule-display").attr("width",24*t+24*l+8*s),$("#rule-display").attr("height",t*2+s+2));let e=1,o=0;for(let r=7;r>=0;r--){i.fillStyle=parseInt(a.rule[r])?"black":"white";const c=Math.floor(e*(t*3)+e*(l*3)+e*s-(t*2+l));i.fillRect(c,t+s,t,t),i.fillStyle="black",i.strokeRect(c,t+s,t,t);const f=r.toString(2).padStart(3,"0");for(let u=0;u<3;u++){i.fillStyle=parseInt(f[u])?"black":"white";const m=u==0?s:0,w=Math.floor(o*t+o*l+(e*s-m)+m);i.fillRect(w,0,t,t),i.fillStyle="black",i.strokeRect(w,0,t,t),o++}e++}}function v(){const i=$("#width").val();n.width=Math.floor(i/a.width)*a.width,d=Math.max(Math.floor(n.width/a.width),1),n.height=d,h.width=n.width,h.height=n.height*5e3,p()}function p(){for(let i=0;i<a.width;i++)h.ctx.fillStyle=a.cells[i]?"black":"white",h.ctx.fillRect(d*i,a.time*d,d,d);n.height+=d,n.ctx.drawImage(h,0,0)}</script>
    <style rel="stylesheet" crossorigin>body{padding:2%;font-size:1.75rem;color:#fff;background-color:#515151}h1{font-size:2.5rem;font-variant:small-caps;text-shadow:2px 2px black}h2{font-size:2rem}#top{margin-top:2rem;display:-webkit-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-wrap:wrap;justify-content:space-between;overflow:hidden}#new-automata form#create-ca{width:fit-content;margin:2% 0;padding:20px;color:#000;background-color:#d9d9d9}#new-automata form#create-ca .form-input{margin-bottom:5px}#new-automata form#create-ca label{margin-right:1rem}#new-automata form#create-ca input:not([type=submit]),#new-automata form#create-ca select{float:right}.info{display:none}.info#ca-info h2{margin:0 auto 1rem}.info#ca-info p{margin:0}.info#rule-info{margin:2% 0 5%}.info#rule-info #rule-display{width:calc(100% - 30px);padding:15px;display:block;background-color:#a0a0a0}#automata{display:none}#automata #menu{padding:10px;position:-webkit-sticky;position:sticky;top:0;color:#000;background-color:#d9d9d9}#automata #menu #speed{width:4em}#automata #menu #animate{margin-right:2rem}#automata #menu #step{float:right}#automata #grid{width:100%;display:block;image-rendering:pixelated}</style>
  </head>
  <body>
    <h1>Elementary Cellular Automata Visualizer</h1>
    <hr />

    <div id="top">
      <div id="ca-info" class="info">
        <h2 id="automata-title">Current Automata: <span id="automata-name"></span></h2>
        <p><i>Step:</i> run rule on each cell once</p>
        <p><i>Animate:</i> step continuously</p>
        <p><i>Speed:</i> how often to animate (in seconds)</p>
        <p><i>Auto scroll:</i> automatically scroll when animating</p>
        <br/>
      </div>

      <!-- Create a new cellular automata -->
      <div id="new-automata">
        <span>Create New Automata:</span>
        <form id="create-ca">

          <div class="form-input">
            <label for="width">Lattice width:</label>
            <input id="width" name="width" type="number" min="3" max="1001" step="1" placeholder="255" required>
          </div>

          <div class="form-input">
            <label for="rule">Rule:</label>
            <input id="rule" name="rule" type="number" min="0" max="255" step="1" placeholder="90" required>
          </div>

          <div class="form-input">
            <label for="start">Start state:</label>
            <select id="start" name="start" required>
              <option value="middle" selected>Middle On</option>
              <option value="random">Random</option>
            </select>
          </div>

          <input id="create" type="submit" value="Create Automatata" />
        </form>
      </div>
      </div>

    <div id="rule-info" class="info">
      Rule: <span id="rule-string"></span>
      <canvas id="rule-display"></canvas>
    </div>

    <div id="automata">
      <div id="menu">
        <!-- How often to animate -->
        <label for="speed">Speed (s): </label><input id="speed" name="speed" type="number" min="0" max="60" step="0.01" value="0.1">
        <!-- Increase time step once/speed -->
        <button id="animate">Animate</button>
        <!-- Auto scroll -->
        <label for="scroll">Auto scroll: </label>
        <input id="scroll" name="scroll" type="checkbox" checked>

        <!-- Increase time step by one -->
        <button id="step">Step</button>
      </div>

      <canvas id="grid"></canvas>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </body>
</html>