<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CA</title>
    <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function i(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(l){if(l.ep)return;l.ep=!0;const r=i(l);fetch(l.href,r)}})();const g=class{constructor(e,t,i){this.colNum=e,this.rule=t,this.iteration=0,i=i!="middle"&&i!="random"?"middle":i,i=="middle"?(this.cells=[...new Array(this.colNum)].map(()=>0),this.cells[Math.floor(this.colNum/2)]=1):this.cells=[...new Array(this.colNum)].map(()=>Math.round(Math.random()))}iterate(){let e=[];for(let t=0;t<this.colNum;t++){const i=this.cells[(t-1+this.colNum)%this.colNum],o=this.cells[t],l=this.cells[(t+1)%this.colNum],r=parseInt(`${i}${o}${l}`,2);e[t]=parseInt(this.rule[r])}this.cells=e,this.iteration++}};let n,c,f;w();function w(){f=$("#grid")[0].getContext("2d"),$("#create-ca").on("submit",function(o){o.preventDefault(),i();const l=parseInt(o.target.cols.value),r=o.target.start.value;let s=parseInt(o.target.rule.value);const a="Rule "+s;return s=s.toString(2).padStart(8,"0"),s=s.split("").reverse().join(""),n=new g(l,s,r),N(),$("#automata-name").text(a),$("#rule-string").text(n.rule),$(".info").show(),$("#automata").show(),y(),!1});let e=!1,t;$("button#animate").on("click",function(){const o=$("#speed").val();e?(clearInterval(t),$(this).text("Animate")):(t=setInterval(()=>{n.iterate(),d()},o*1e3),$(this).text("Stop Animation")),e=!e});const i=()=>{clearInterval(t),e=!1,$("button#animate").text("Animate")};$("button#iterate").on("click",()=>{i(),n.iterate(),d()})}function y(){const e=$("#rule-display")[0].getContext("2d"),t=35,i=3,o=5*i;$("#rule-display").attr("width")||($("#rule-display").attr("width",24*t+24*i+8*o),$("#rule-display").attr("height",t*2+o+2));let l=1,r=0;for(let s=7;s>=0;s--){e.fillStyle=parseInt(n.rule[s])?"black":"white";const a=Math.floor(l*(t*3)+l*(i*3)+l*o-(t*2+i));e.fillRect(a,t+o,t,t),e.fillStyle="black",e.strokeRect(a,t+o,t,t);const p=s.toString(2).padStart(3,"0");for(let u=0;u<3;u++){e.fillStyle=parseInt(p[u])?"black":"white";const h=u==0?o:0,m=Math.floor(r*t+r*i+(l*o-h)+h);e.fillRect(m,0,t,t),e.fillStyle="black",e.strokeRect(m,0,t,t),r++}l++}}function N(){const e=$("#grid")[0];f.clearRect(0,0,e.width,e.height);const t=Math.floor(1001/n.colNum)*n.colNum*2;t!=e.width&&(e.width=t,c=Math.floor(e.width/n.colNum),e.height=c*1e3),d()}function d(){for(let e=0;e<n.colNum;e++)f.fillStyle=n.cells[e]?"black":"white",f.fillRect(c*e,n.iteration*c,c,c)}</script>
    <style rel="stylesheet" crossorigin>body{padding:2%;font-size:1.75rem;color:#fff;background-color:#515151}#top{display:-webkit-box;display:-ms-flexbox;display:-webkit-flex;display:flex;flex-wrap:wrap;justify-content:space-between;overflow:hidden}#new-automata form#create-ca{width:fit-content;margin:2% 0;padding:20px;color:#000;background-color:#d9d9d9}#new-automata form#create-ca p{font-size:1.25rem}#new-automata form#create-ca .form-input{margin-bottom:5px}#new-automata form#create-ca label{margin-right:1rem}#new-automata form#create-ca input:not([type=submit]),#new-automata form#create-ca select{float:right}.info{display:none}.info#ca-info #automata-title{font-size:2rem;font-weight:700;font-variant:small-caps;text-decoration:underline}.info#ca-info p{margin:0}.info#rule-info{margin:2% 0 5%}.info#rule-info #rule-display{width:calc(100% - 30px);padding:15px;display:block;background-color:#a0a0a0}#automata{display:none;clear:both}#automata #menu{padding:10px;position:-webkit-sticky;position:sticky;top:0;color:#000;background-color:#d9d9d9}#automata #menu #iterate{float:right}#automata #grid{width:100%;image-rendering:pixelated}</style>
  </head>
  <body>
    <div id="top">
      <div id="ca-info" class="info">
        <span id="automata-title">Current Automata: <span id="automata-name"></span></span>
        <br/>
        <p>Speed: how often to animate in seconds</p>
        <p>Animate: iterate once per speed unit</p>
        <p>Iterate: run rules on each cell once</p>
        <br/>
      </div>

      <!-- Create a new cellular automata -->
      <div id="new-automata">
        <span>Create New Automata:</span>
        <form id="create-ca">

          <div class="form-input">
            <label for="cols">Number of columns:</label>
            <input id="cols" name="cols" type="number" min="101" max="1001" step="1" value="255" required>
          </div>

          <div class="form-input">
            <label for="rule">Rule:</label>
            <input id="rule" name="rule" type="number" min="0" max="255" step="1" value="90" required>
          </div>

          <div class="form-input">
            <label for="start">Start state:</label>
            <select id="start" name="start" required>
              <option value="middle" selected>Middle On</option>
              <option value="random">Random</option>
            </select>
          </div>

          <input id="create" type="submit" value="Create Automatata" />
        </form>
      </div>
      </div>

    <div id="rule-info" class="info">
      Rule: <span id="rule-string"></span>
      <canvas id="rule-display"></canvas>
    </div>

    <div id="automata">
      <div id="menu">
        <!-- How often to animate -->
        <label for="speed">Speed: </label><input id="speed" name="speed" type="number" min="0" max="100" step="0.01" value="0.1">
        <!-- Iterate over rules once/speed -->
        <button id="animate">Animate</button>

        <!-- Iterate over rules once -->
        <button id="iterate">Iterate</button>
      </div>

      <canvas id="grid"></canvas>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </body>
</html>